import{useState as t,useRef as n,useEffect as r,useCallback as e}from"react";function o(t,n,r){return Math.round(.2126*t+.7152*n+.0722*r)}function a(t,n){const r=(t-128)*n+128;return Math.min(255,Math.max(0,r))}function i(t,n){return n>0?t+(255-t)*n:n<0?t+t*n:t}function s(t,n){const r=Math.min(255,Math.max(0,t))/255,e=Math.pow(r,1.5),o=Math.floor(e*(n.length-1));return n[Math.min(Math.max(o,0),n.length-1)]}const c={width:80,height:40,charset:"$@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\\|()1{}[]?-_+~<>i!lI;:,\"^`'. ",invert:!1,contrast:1,brightness:0,preserveAspectRatio:!0,backgroundColor:"#000000"};class l{constructor(t={}){this.options={...c,...t},this.canvas=document.createElement("canvas");const n=this.canvas.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("Could not create canvas context");this.ctx=n}setOptions(t){this.options={...this.options,...t}}async fromImageElement(t,n){return this.convertImage(t,n)}async fromUrl(t){const n=await function(t){return new Promise((n,r)=>{const e=new Image;e.crossOrigin="Anonymous",e.onload=()=>n(e),e.onerror=t=>r(new Error(`Failed to load image: ${t}`)),e.src=t})}(t);return this.convertImage(n)}fromFile(t){return new Promise((n,r)=>{const e=new FileReader;e.onload=async t=>{var e;try{if(!(null===(e=t.target)||void 0===e?void 0:e.result))throw new Error("Failed to read file");const o=new Image;o.onload=async()=>{try{const t=await this.convertImage(o);n(t)}catch(t){r(t)}},o.onerror=()=>r(new Error("Failed to load image from file")),o.src=t.target.result}catch(t){r(t)}},e.onerror=()=>r(new Error("Failed to read file")),e.readAsDataURL(t)})}async convertImage(t,n){const r={...this.options,...n},{width:e,height:c,contrast:l,brightness:h,invert:u,charset:d,backgroundColor:g,preserveAspectRatio:m}=r;let f=e,w=c;if(m){const n=t.width/t.height;f/w>n?f=Math.floor(w*n):w=Math.floor(f/n)}this.canvas.width=f,this.canvas.height=w,function(t,n){const r=t.getContext("2d");r&&(r.fillStyle=n,r.fillRect(0,0,t.width,t.height))}(this.canvas,g),this.ctx.drawImage(t,0,0,f,w);const v=this.ctx.getImageData(0,0,f,w).data;let p="";for(let t=0;t<w;t++){for(let n=0;n<f;n++){const r=4*(t*f+n);let e=o(v[r],v[r+1],v[r+2]);e=a(e,l),e=i(e,h),e=u?255-e:e,p+=s(e,d)}p+="\n"}return{ascii:p,width:f,height:w,charset:d}}}function h(o={}){var a,i,s;const[c,h]=t(null),[u,d]=t(!1),[g,m]=t(null),f=n(o);r(()=>{f.current=o},[o]);const w=e(async(t,n)=>{d(!0),m(null);try{const r={...f.current,...n},e=new l(r);let o;o="string"==typeof t?await e.fromUrl(t):t instanceof File?await e.fromFile(t):await e.fromImageElement(t),h(o)}catch(t){m(t instanceof Error?t:new Error(String(t))),h(null)}finally{d(!1)}},[]);return{ascii:null!==(a=null==c?void 0:c.ascii)&&void 0!==a?a:"",width:null!==(i=null==c?void 0:c.width)&&void 0!==i?i:0,height:null!==(s=null==c?void 0:c.height)&&void 0!==s?s:0,result:c,isLoading:u,error:g,convert:w}}export{l as HexPic,l as default,h as useHexPic};
//# sourceMappingURL=index.esm.js.map
