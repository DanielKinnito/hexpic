function t(t,e,r){return Math.round(.299*t+.587*e+.114*r)}function e(t,e){return Math.min(255,Math.max(0,255*((t/255-.5)*e+.5)))}function r(t,e){return e>0?t+(255-t)*e:e<0?t+t*e:t}function n(t,e){const r=255-t,n=Math.floor(r/255*(e.length-1));return e[Math.min(n,e.length-1)]}const o={width:80,height:40,charset:"@%#*+=-:. ",invert:!1,contrast:1,brightness:0,preserveAspectRatio:!0,backgroundColor:"#000000"};class a{constructor(t={}){this.options={...o,...t},this.canvas=document.createElement("canvas");const e=this.canvas.getContext("2d",{willReadFrequently:!0});if(!e)throw new Error("Could not create canvas context");this.ctx=e}setOptions(t){this.options={...this.options,...t}}async fromImageElement(t,e){return this.convertImage(t)}async fromUrl(t){const e=await function(t){return new Promise((e,r)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>e(n),n.onerror=t=>r(new Error(`Failed to load image: ${t}`)),n.src=t})}(t);return this.convertImage(e)}fromFile(t){return new Promise((e,r)=>{const n=new FileReader;n.onload=async t=>{var n;try{if(!(null===(n=t.target)||void 0===n?void 0:n.result))throw new Error("Failed to read file");const o=new Image;o.onload=async()=>{try{const t=await this.convertImage(o);e(t)}catch(t){r(t)}},o.onerror=()=>r(new Error("Failed to load image from file")),o.src=t.target.result}catch(t){r(t)}},n.onerror=()=>r(new Error("Failed to read file")),n.readAsDataURL(t)})}async convertImage(o){const{width:a,height:s,contrast:i,brightness:c,invert:h,charset:l,backgroundColor:d,preserveAspectRatio:g}=this.options;let u=a,f=s;if(g){const t=o.width/o.height;u/f>t?u=Math.floor(f*t):f=Math.floor(u/t)}this.canvas.width=u,this.canvas.height=f,function(t,e){const r=t.getContext("2d");r&&(r.fillStyle=e,r.fillRect(0,0,t.width,t.height))}(this.canvas,d),this.ctx.drawImage(o,0,0,u,f);const m=this.ctx.getImageData(0,0,u,f).data;let w="";for(let o=0;o<f;o++){for(let a=0;a<u;a++){const s=4*(o*u+a);let d=t(m[s],m[s+1],m[s+2]);d=e(d,i),d=r(d,c),d=h?255-d:d,w+=n(d,l)}w+="\n"}return{ascii:w,width:u,height:f,charset:l}}}export{a as HexPic,a as default};
//# sourceMappingURL=index.esm.js.map
