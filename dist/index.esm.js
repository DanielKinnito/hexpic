import e,{useState as t,useRef as r,useEffect as o,useCallback as n}from"react";function a(e,t,r){return Math.round(.2126*e+.7152*t+.0722*r)}function i(e,t){const r=(e-128)*t+128;return Math.min(255,Math.max(0,r))}function s(e,t){return t>0?e+(255-e)*t:t<0?e+e*t:e}function c(e,t){const r=Math.min(255,Math.max(0,e))/255,o=Math.pow(r,1.5),n=Math.floor(o*(t.length-1));return t[Math.min(Math.max(n,0),t.length-1)]}const l={width:80,height:40,charset:"$@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\\|()1{}[]?-_+~<>i!lI;:,\"^`'. ",invert:!1,contrast:1,brightness:0,preserveAspectRatio:!0,backgroundColor:"#000000",fontAspectRatio:.55};class u{constructor(e={}){this.options={...l,...e},this.canvas=document.createElement("canvas");const t=this.canvas.getContext("2d",{willReadFrequently:!0});if(!t)throw new Error("Could not create canvas context");this.ctx=t}setOptions(e){this.options={...this.options,...e}}async fromImageElement(e,t){return this.convertImage(e,t)}async fromUrl(e){const t=await function(e){return new Promise((t,r)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=()=>t(o),o.onerror=e=>r(new Error(`Failed to load image: ${e}`)),o.src=e})}(e);return this.convertImage(t)}fromFile(e){return new Promise((t,r)=>{const o=new FileReader;o.onload=async e=>{var o;try{if(!(null===(o=e.target)||void 0===o?void 0:o.result))throw new Error("Failed to read file");const n=new Image;n.onload=async()=>{try{const e=await this.convertImage(n);t(e)}catch(e){r(e)}},n.onerror=()=>r(new Error("Failed to load image from file")),n.src=e.target.result}catch(e){r(e)}},o.onerror=()=>r(new Error("Failed to read file")),o.readAsDataURL(e)})}async convertImage(e,t){const r={...this.options,...t},{width:o,height:n,contrast:l,brightness:u,invert:f,charset:d,backgroundColor:p,preserveAspectRatio:y,fontAspectRatio:m}=r;let h=o,g=n;if(y){const t=e.width/e.height/m;h/g>t?h=Math.floor(g*t):g=Math.floor(h/t)}this.canvas.width=h,this.canvas.height=g,function(e,t){const r=e.getContext("2d");r&&(r.fillStyle=t,r.fillRect(0,0,e.width,e.height))}(this.canvas,p),this.ctx.drawImage(e,0,0,h,g);const v=this.ctx.getImageData(0,0,h,g).data;let b="";for(let e=0;e<g;e++){for(let t=0;t<h;t++){const r=4*(e*h+t);let o=a(v[r],v[r+1],v[r+2]);o=i(o,l),o=s(o,u),o=f?255-o:o,b+=c(o,d)}b+="\n"}return{ascii:b,width:h,height:g,charset:d}}}var f,d={exports:{}},p={};var y,m={};
/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */"production"===process.env.NODE_ENV?d.exports=function(){if(f)return p;f=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(t,r,o){var n=null;if(void 0!==o&&(n=""+o),void 0!==r.key&&(n=""+r.key),"key"in r)for(var a in o={},r)"key"!==a&&(o[a]=r[a]);else o=r;return r=o.ref,{$$typeof:e,type:t,key:n,ref:void 0!==r?r:null,props:o}}return p.Fragment=t,p.jsx=r,p.jsxs=r,p}():d.exports=(y||(y=1,"production"!==process.env.NODE_ENV&&function(){function t(e){if(null==e)return null;if("function"==typeof e)return e.$$typeof===O?null:e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case y:return"Fragment";case g:return"Profiler";case h:return"StrictMode";case _:return"Suspense";case k:return"SuspenseList";case j:return"Activity"}if("object"==typeof e)switch("number"==typeof e.tag&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),e.$$typeof){case p:return"Portal";case b:return e.displayName||"Context";case v:return(e._context.displayName||"Context")+".Consumer";case w:var r=e.render;return(e=e.displayName)||(e=""!==(e=r.displayName||r.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case S:return null!==(r=e.displayName||null)?r:t(e.type)||"Memo";case x:r=e._payload,e=e._init;try{return t(e(r))}catch(e){}}return null}function r(e){return""+e}function o(e){try{r(e);var t=!1}catch(e){t=!0}if(t){var o=(t=console).error,n="function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return o.call(t,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",n),r(e)}}function n(e){if(e===y)return"<>";if("object"==typeof e&&null!==e&&e.$$typeof===x)return"<...>";try{var r=t(e);return r?"<"+r+">":"<...>"}catch(e){return"<...>"}}function a(){return Error("react-stack-top-frame")}function i(){var e=t(this.type);return A[e]||(A[e]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),void 0!==(e=this.props.ref)?e:null}function s(e,r,n,a,s,l){var f,p=r.children;if(void 0!==p)if(a)if(P(p)){for(a=0;a<p.length;a++)c(p[a]);Object.freeze&&Object.freeze(p)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else c(p);if(R.call(r,"key")){p=t(e);var y=Object.keys(r).filter(function(e){return"key"!==e});a=0<y.length?"{key: someKey, "+y.join(": ..., ")+": ...}":"{key: someKey}",C[p+a]||(y=0<y.length?"{"+y.join(": ..., ")+": ...}":"{}",console.error('A props object containing a "key" prop is being spread into JSX:\n  let props = %s;\n  <%s {...props} />\nReact keys must be passed directly to JSX without using spread:\n  let props = %s;\n  <%s key={someKey} {...props} />',a,p,y,p),C[p+a]=!0)}if(p=null,void 0!==n&&(o(n),p=""+n),function(e){if(R.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}(r)&&(o(r.key),p=""+r.key),"key"in r)for(var m in n={},r)"key"!==m&&(n[m]=r[m]);else n=r;return p&&function(e,t){function r(){u||(u=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",t))}r.isReactWarning=!0,Object.defineProperty(e,"key",{get:r,configurable:!0})}(n,"function"==typeof e?e.displayName||e.name||"Unknown":e),function(e,t,r,o,n,a){var s=r.ref;return e={$$typeof:d,type:e,key:t,props:r,_owner:o},null!==(void 0!==s?s:null)?Object.defineProperty(e,"ref",{enumerable:!1,get:i}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:n}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:a}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}(e,p,n,null===(f=E.A)?null:f.getOwner(),s,l)}function c(e){l(e)?e._store&&(e._store.validated=1):"object"==typeof e&&null!==e&&e.$$typeof===x&&("fulfilled"===e._payload.status?l(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function l(e){return"object"==typeof e&&null!==e&&e.$$typeof===d}var u,f=e,d=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),v=Symbol.for("react.consumer"),b=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),S=Symbol.for("react.memo"),x=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),O=Symbol.for("react.client.reference"),E=f.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,R=Object.prototype.hasOwnProperty,P=Array.isArray,I=console.createTask?console.createTask:function(){return null},A={},N=(f={react_stack_bottom_frame:function(e){return e()}}).react_stack_bottom_frame.bind(f,a)(),F=I(n(a)),C={};m.Fragment=y,m.jsx=function(e,t,r){var o=1e4>E.recentlyCreatedOwnerStacks++;return s(e,t,r,!1,o?Error("react-stack-top-frame"):N,o?I(n(e)):F)},m.jsxs=function(e,t,r){var o=1e4>E.recentlyCreatedOwnerStacks++;return s(e,t,r,!0,o?Error("react-stack-top-frame"):N,o?I(n(e)):F)}}()),m);var h=d.exports;function g(e={}){var a,i,s;const[c,l]=t(null),[f,d]=t(!1),[p,y]=t(null),m=r(e);o(()=>{m.current=e},[e]);const h=n(async(e,t)=>{console.log("useHexPic: convert called",{source:e,options:t}),d(!0),y(null);try{const r={...m.current,...t};console.log("useHexPic: options merged",r);const o=new u(r);let n;"string"==typeof e?(console.log("useHexPic: converting from URL"),n=await o.fromUrl(e)):e instanceof File?(console.log("useHexPic: converting from File"),n=await o.fromFile(e)):(console.log("useHexPic: converting from Image Element"),n=await o.fromImageElement(e)),console.log("useHexPic: conversion successful",{width:n.width,height:n.height,asciiLength:n.ascii.length}),l(n)}catch(e){console.error("useHexPic: conversion failed",e),y(e instanceof Error?e:new Error(String(e))),l(null)}finally{d(!1)}},[]);return{ascii:null!==(a=null==c?void 0:c.ascii)&&void 0!==a?a:"",width:null!==(i=null==c?void 0:c.width)&&void 0!==i?i:0,height:null!==(s=null==c?void 0:c.height)&&void 0!==s?s:0,result:c,isLoading:f,error:p,convert:h}}const v=({src:e,alt:t,options:r,style:n,...a})=>{const{ascii:i,isLoading:s,error:c,convert:l}=g(r);return o(()=>{e&&l(e)},[e,l,r]),c?(console.error("HexPicImage error:",c),h.jsx("div",{style:{color:"red",...n},...a,children:"Error generating ASCII art"})):h.jsx("div",{style:{fontFamily:"monospace",whiteSpace:"pre",lineHeight:"0.6em",overflow:"hidden",fontSize:"10px",...n},"aria-label":t||"ASCII Art",role:"img",...a,children:s?"Loading...":i})};export{u as HexPic,v as HexPicImage,u as default,g as useHexPic};
//# sourceMappingURL=index.esm.js.map
