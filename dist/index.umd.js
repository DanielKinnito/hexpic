!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).HexPic={},t.React)}(this,function(t,e){"use strict";function n(t,e,n){return Math.round(.2126*t+.7152*e+.0722*n)}function o(t,e){const n=(t-128)*e+128;return Math.min(255,Math.max(0,n))}function r(t,e){return e>0?t+(255-t)*e:e<0?t+t*e:t}function i(t,e){const n=Math.min(255,Math.max(0,t))/255,o=Math.pow(n,1.5),r=Math.floor(o*(e.length-1));return e[Math.min(Math.max(r,0),e.length-1)]}const a={width:80,height:40,charset:"@%#*+=-:. ",invert:!1,contrast:1,brightness:0,preserveAspectRatio:!0,backgroundColor:"#000000"};class s{constructor(t={}){this.options={...a,...t},this.canvas=document.createElement("canvas");const e=this.canvas.getContext("2d",{willReadFrequently:!0});if(!e)throw new Error("Could not create canvas context");this.ctx=e}setOptions(t){this.options={...this.options,...t}}async fromImageElement(t,e){return this.convertImage(t,e)}async fromUrl(t){const e=await function(t){return new Promise((e,n)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=()=>e(o),o.onerror=t=>n(new Error(`Failed to load image: ${t}`)),o.src=t})}(t);return this.convertImage(e)}fromFile(t){return new Promise((e,n)=>{const o=new FileReader;o.onload=async t=>{var o;try{if(!(null===(o=t.target)||void 0===o?void 0:o.result))throw new Error("Failed to read file");const r=new Image;r.onload=async()=>{try{const t=await this.convertImage(r);e(t)}catch(t){n(t)}},r.onerror=()=>n(new Error("Failed to load image from file")),r.src=t.target.result}catch(t){n(t)}},o.onerror=()=>n(new Error("Failed to read file")),o.readAsDataURL(t)})}async convertImage(t,e){const a={...this.options,...e},{width:s,height:c,contrast:l,brightness:h,invert:u,charset:d,backgroundColor:f,preserveAspectRatio:g}=a;let m=s,w=c;if(g){const e=t.width/t.height;m/w>e?m=Math.floor(w*e):w=Math.floor(m/e)}this.canvas.width=m,this.canvas.height=w,function(t,e){const n=t.getContext("2d");n&&(n.fillStyle=e,n.fillRect(0,0,t.width,t.height))}(this.canvas,f),this.ctx.drawImage(t,0,0,m,w);const v=this.ctx.getImageData(0,0,m,w).data;let p="";for(let t=0;t<w;t++){for(let e=0;e<m;e++){const a=4*(t*m+e);let s=n(v[a],v[a+1],v[a+2]);s=o(s,l),s=r(s,h),s=u?255-s:s,p+=i(s,d)}p+="\n"}return{ascii:p,width:m,height:w,charset:d}}}t.HexPic=s,t.default=s,t.useHexPic=function(t={}){var n,o,r;const[i,a]=e.useState(null),[c,l]=e.useState(!1),[h,u]=e.useState(null),d=e.useRef(t);e.useEffect(()=>{d.current=t},[t]);const f=e.useCallback(async(t,e)=>{l(!0),u(null);try{const n={...d.current,...e},o=new s(n);let r;r="string"==typeof t?await o.fromUrl(t):t instanceof File?await o.fromFile(t):await o.fromImageElement(t),a(r)}catch(t){u(t instanceof Error?t:new Error(String(t))),a(null)}finally{l(!1)}},[]);return{ascii:null!==(n=null==i?void 0:i.ascii)&&void 0!==n?n:"",width:null!==(o=null==i?void 0:i.width)&&void 0!==o?o:0,height:null!==(r=null==i?void 0:i.height)&&void 0!==r?r:0,result:i,isLoading:c,error:h,convert:f}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
