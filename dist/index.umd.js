!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).HexPic={})}(this,function(t){"use strict";function e(t,e,n){return Math.round(.299*t+.587*e+.114*n)}function n(t,e){return Math.min(255,Math.max(0,255*((t/255-.5)*e+.5)))}function o(t,e){return e>0?t+(255-t)*e:e<0?t+t*e:t}function r(t,e){const n=255-t,o=Math.floor(n/255*(e.length-1));return e[Math.min(o,e.length-1)]}const i={width:80,height:40,charset:"@%#*+=-:. ",invert:!1,contrast:1,brightness:0,preserveAspectRatio:!0,backgroundColor:"#000000"};class a{constructor(t={}){this.options={...i,...t},this.canvas=document.createElement("canvas");const e=this.canvas.getContext("2d",{willReadFrequently:!0});if(!e)throw new Error("Could not create canvas context");this.ctx=e}setOptions(t){this.options={...this.options,...t}}async fromImageElement(t,e){return this.convertImage(t)}async fromUrl(t){const e=await function(t){return new Promise((e,n)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=()=>e(o),o.onerror=t=>n(new Error(`Failed to load image: ${t}`)),o.src=t})}(t);return this.convertImage(e)}fromFile(t){return new Promise((e,n)=>{const o=new FileReader;o.onload=async t=>{var o;try{if(!(null===(o=t.target)||void 0===o?void 0:o.result))throw new Error("Failed to read file");const r=new Image;r.onload=async()=>{try{const t=await this.convertImage(r);e(t)}catch(t){n(t)}},r.onerror=()=>n(new Error("Failed to load image from file")),r.src=t.target.result}catch(t){n(t)}},o.onerror=()=>n(new Error("Failed to read file")),o.readAsDataURL(t)})}async convertImage(t){const{width:i,height:a,contrast:s,brightness:c,invert:h,charset:l,backgroundColor:d,preserveAspectRatio:f}=this.options;let u=i,g=a;if(f){const e=t.width/t.height;u/g>e?u=Math.floor(g*e):g=Math.floor(u/e)}this.canvas.width=u,this.canvas.height=g,function(t,e){const n=t.getContext("2d");n&&(n.fillStyle=e,n.fillRect(0,0,t.width,t.height))}(this.canvas,d),this.ctx.drawImage(t,0,0,u,g);const m=this.ctx.getImageData(0,0,u,g).data;let w="";for(let t=0;t<g;t++){for(let i=0;i<u;i++){const a=4*(t*u+i);let d=e(m[a],m[a+1],m[a+2]);d=n(d,s),d=o(d,c),d=h?255-d:d,w+=r(d,l)}w+="\n"}return{ascii:w,width:u,height:g,charset:l}}}t.HexPic=a,t.default=a,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
